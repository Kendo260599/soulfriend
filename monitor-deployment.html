<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <title>ğŸ” Monitor Railway Deployment</title>
    <style>
        body {
            font-family: monospace;
            background: #1e1e1e;
            color: #00ff00;
            padding: 20px;
        }
        .log { margin: 5px 0; padding: 5px; }
        .success { color: #00ff00; }
        .error { color: #ff0000; }
        .warning { color: #ffaa00; }
        .info { color: #00aaff; }
        button {
            background: #00ff00;
            color: #000;
            border: none;
            padding: 10px 20px;
            margin: 10px 5px;
            cursor: pointer;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <h1>ğŸ” Railway Deployment Monitor</h1>
    <p>Backend: https://soulfriend-production.up.railway.app</p>
    
    <div>
        <button onclick="testDeployment()">ğŸ§ª Test Deployment</button>
        <button onclick="testCrisis()">ğŸš¨ Test Crisis Detection</button>
        <button onclick="clearLogs()">ğŸ—‘ï¸ Clear</button>
    </div>
    
    <div id="logs"></div>

    <script>
        const BACKEND_URL = 'https://soulfriend-production.up.railway.app';

        function log(message, type = 'info') {
            const div = document.createElement('div');
            div.className = `log ${type}`;
            div.textContent = `[${new Date().toLocaleTimeString()}] ${message}`;
            document.getElementById('logs').appendChild(div);
            div.scrollIntoView({ behavior: 'smooth' });
        }

        function clearLogs() {
            document.getElementById('logs').innerHTML = '';
        }

        async function testDeployment() {
            log('ğŸ”„ Starting deployment test...', 'info');
            
            try {
                const health = await fetch(`${BACKEND_URL}/api/health`);
                const data = await health.json();
                
                if (health.ok) {
                    log(`âœ… Backend is UP (Status: ${data.status})`, 'success');
                    log(`âœ… Gemini: ${data.gemini}`, 'success');
                    log(`âœ… Chatbot: ${data.chatbot}`, 'success');
                } else {
                    log(`âŒ Backend unhealthy: ${health.status}`, 'error');
                }
            } catch (error) {
                log(`âŒ Backend connection failed: ${error.message}`, 'error');
            }
        }

        async function testCrisis() {
            log('ğŸš¨ Testing crisis detection...', 'warning');
            
            try {
                const response = await fetch(`${BACKEND_URL}/api/v2/chatbot/message`, {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({
                        message: 'TÃ´i muá»‘n tá»± tá»­, tÃ´i khÃ´ng thá»ƒ chá»‹u Ä‘á»±ng Ä‘Æ°á»£c ná»¯a',
                        userId: 'crisis_test_' + Date.now(),
                        sessionId: 'crisis_session_' + Date.now()
                    })
                });

                const data = await response.json();
                
                if (response.ok && data.success) {
                    log(`ğŸ“¤ Response received:`, 'info');
                    log(`   Risk Level: ${data.data.riskLevel}`, 
                        data.data.riskLevel === 'CRITICAL' ? 'success' : 'error');
                    log(`   Crisis Level: ${data.data.crisisLevel}`, 
                        data.data.crisisLevel === 'critical' ? 'success' : 'error');
                    log(`   Emergency Contacts: ${data.data.emergencyContacts?.length || 0}`, 
                        data.data.emergencyContacts?.length > 0 ? 'success' : 'error');
                    
                    if (data.data.riskLevel === 'CRITICAL') {
                        log('', 'info');
                        log('âœ…âœ…âœ… CRISIS DETECTION: WORKING!', 'success');
                        log('âœ…âœ…âœ… HITL SYSTEM: ACTIVATED!', 'success');
                        log('', 'info');
                        log('âš ï¸  CHECK RAILWAY LOGS FOR:', 'warning');
                        log('   - ğŸ” CRISIS DEBUG messages', 'warning');
                        log('   - ğŸš¨ CRISIS DETECTED alerts', 'warning');
                        log('   - ğŸš¨ HITL Alert created', 'warning');
                        log('   - â±ï¸  Escalation timer messages', 'warning');
                    } else {
                        log('', 'info');
                        log('âŒâŒâŒ CRISIS DETECTION: NOT WORKING!', 'error');
                        log(`Expected riskLevel=CRITICAL, got ${data.data.riskLevel}`, 'error');
                        log(`Expected crisisLevel=critical, got ${data.data.crisisLevel}`, 'error');
                        log('', 'info');
                        log('ğŸ” DEBUGGING STEPS:', 'warning');
                        log('1. Check Railway logs for deployment', 'warning');
                        log('2. Look for ğŸ” CRISIS DEBUG messages', 'warning');
                        log('3. Verify code was deployed successfully', 'warning');
                    }
                    
                    log('', 'info');
                    log(`Response preview: ${data.data.message.substring(0, 100)}...`, 'info');
                } else {
                    log(`âŒ API error: ${data.error || 'Unknown error'}`, 'error');
                }
            } catch (error) {
                log(`âŒ Crisis test failed: ${error.message}`, 'error');
            }
        }

        // Auto test on load after 2 seconds
        setTimeout(() => {
            log('ğŸš€ Auto-testing deployment...', 'info');
            testDeployment();
        }, 2000);
    </script>
</body>
</html>

