<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Chatbot Fix</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .test-container {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        .test-button {
            background: #d63384;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        .test-button:hover {
            background: #c02a5c;
        }
        .result {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 5px;
            margin-top: 10px;
            border-left: 4px solid #d63384;
        }
        .error {
            border-left-color: #dc3545;
            background: #f8d7da;
        }
        .success {
            border-left-color: #28a745;
            background: #d4edda;
        }
    </style>
</head>
<body>
    <h1>ü§ñ Test Chatbot Fix</h1>
    
    <div class="test-container">
        <h2>Test 1: Gemini API Connection</h2>
        <button class="test-button" onclick="testGeminiAPI()">Test Gemini API</button>
        <div id="gemini-result" class="result" style="display: none;"></div>
    </div>
    
    <div class="test-container">
        <h2>Test 1.5: Offline Service</h2>
        <button class="test-button" onclick="testOfflineService()">Test Offline Service</button>
        <div id="offline-result" class="result" style="display: none;"></div>
    </div>
    
    <div class="test-container">
        <h2>Test 2: Chatbot v·ªõi Test Results</h2>
        <button class="test-button" onclick="testChatbotWithResults()">Test Chatbot v·ªõi Test Results</button>
        <div id="chatbot-result" class="result" style="display: none;"></div>
    </div>
    
    <div class="test-container">
        <h2>Test 3: Fallback Response</h2>
        <button class="test-button" onclick="testFallbackResponse()">Test Fallback Response</button>
        <div id="fallback-result" class="result" style="display: none;"></div>
    </div>

    <script>
        const GEMINI_API_KEY = 'AIzaSyBaswf5ksxu1g7WvhS2_Hy7PHqWpjZu8LM';
        const GEMINI_API_URL = 'https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent';
        
        // Mock test results
        const mockTestResults = [
            {
                testType: 'DASS_21',
                totalScore: 15,
                maxScore: 63,
                evaluation: {
                    level: 'Trung b√¨nh',
                    description: 'M·ª©c ƒë·ªô lo √¢u v√† stress ·ªü m·ª©c trung b√¨nh'
                }
            },
            {
                testType: 'PHQ_9',
                totalScore: 8,
                maxScore: 27,
                evaluation: {
                    level: 'Nh·∫π',
                    description: 'Tri·ªáu ch·ª©ng tr·∫ßm c·∫£m nh·∫π'
                }
            }
        ];
        
        async function testGeminiAPI() {
            const resultDiv = document.getElementById('gemini-result');
            resultDiv.style.display = 'block';
            resultDiv.innerHTML = 'üîÑ ƒêang test Gemini API...';
            
            try {
                const response = await fetch(
                    `${GEMINI_API_URL}?key=${GEMINI_API_KEY}`,
                    {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({
                            contents: [{
                                role: 'user',
                                parts: [{ text: 'Xin ch√†o, b·∫°n c√≥ th·ªÉ gi√∫p t√¥i hi·ªÉu k·∫øt qu·∫£ test t√¢m l√Ω kh√¥ng?' }]
                            }],
                            generationConfig: {
                                temperature: 0.7,
                                maxOutputTokens: 500,
                            }
                        })
                    }
                );
                
                if (!response.ok) {
                    const errorText = await response.text();
                    resultDiv.className = 'result error';
                    resultDiv.innerHTML = `‚ùå L·ªói API: ${response.status}<br>${errorText}`;
                    return;
                }
                
                const data = await response.json();
                const text = data.candidates?.[0]?.content?.parts?.[0]?.text || 'Kh√¥ng c√≥ ph·∫£n h·ªìi';
                
                resultDiv.className = 'result success';
                resultDiv.innerHTML = `‚úÖ Gemini API ho·∫°t ƒë·ªông!<br><br><strong>Ph·∫£n h·ªìi:</strong><br>${text}`;
                
            } catch (error) {
                resultDiv.className = 'result error';
                resultDiv.innerHTML = `‚ùå L·ªói: ${error.message}`;
            }
        }
        
        function testOfflineService() {
            const resultDiv = document.getElementById('offline-result');
            resultDiv.style.display = 'block';
            resultDiv.innerHTML = 'üîÑ ƒêang test Offline Service...';
            
            try {
                // Simulate offline service responses
                const testMessages = [
                    "Gi·∫£i th√≠ch k·∫øt qu·∫£ test",
                    "T√¥i ƒëang stress",
                    "T√¥i lo √¢u",
                    "T√¥i tr·∫ßm c·∫£m",
                    "T√¥i thi·∫øu t·ª± tin",
                    "T√¥i c·∫ßn h·ªó tr·ª£ chuy√™n nghi·ªáp"
                ];
                
                let responses = [];
                
                testMessages.forEach((message, index) => {
                    let response = '';
                    const lowerMessage = message.toLowerCase();
                    
                    if (lowerMessage.includes('k·∫øt qu·∫£') || lowerMessage.includes('test')) {
                        response = `üìä **K·∫øt qu·∫£ test c·ªßa b·∫°n:**

B·∫°n ƒë√£ ho√†n th√†nh ${mockTestResults.length} b√†i test: DASS-21 (Lo √¢u, Tr·∫ßm c·∫£m, Stress), PHQ-9 (Tr·∫ßm c·∫£m)

**Chi ti·∫øt k·∫øt qu·∫£:**
1. **DASS-21 (Lo √¢u, Tr·∫ßm c·∫£m, Stress)**: 15/63 ƒëi·ªÉm - Trung b√¨nh
   üìù M·ª©c ƒë·ªô lo √¢u v√† stress ·ªü m·ª©c trung b√¨nh

2. **PHQ-9 (Tr·∫ßm c·∫£m)**: 8/27 ƒëi·ªÉm - Nh·∫π
   üìù Tri·ªáu ch·ª©ng tr·∫ßm c·∫£m nh·∫π

**‚ö†Ô∏è L∆∞u √Ω quan tr·ªçng:**
‚Ä¢ K·∫øt qu·∫£ ch·ªâ mang t√≠nh tham kh·∫£o
‚Ä¢ Kh√¥ng thay th·∫ø ch·∫©n ƒëo√°n chuy√™n m√¥n
‚Ä¢ N√™n th·∫£o lu·∫≠n v·ªõi chuy√™n gia t√¢m l√Ω

**üí° G·ª£i √Ω ti·∫øp theo:**
‚Ä¢ Th·ª±c h√†nh k·ªπ thu·∫≠t th∆∞ gi√£n h√†ng ng√†y
‚Ä¢ Theo d√µi t√¨nh tr·∫°ng theo th·ªùi gian
‚Ä¢ T√¨m ki·∫øm h·ªó tr·ª£ chuy√™n nghi·ªáp n·∫øu c·∫ßn
‚Ä¢ Duy tr√¨ l·ªëi s·ªëng l√†nh m·∫°nh

B·∫°n mu·ªën t√¥i gi·∫£i th√≠ch chi ti·∫øt v·ªÅ test n√†o?`;
                    } else if (lowerMessage.includes('stress')) {
                        response = `üßò‚Äç‚ôÄÔ∏è **Qu·∫£n l√Ω Stress hi·ªáu qu·∫£:**

**K·ªπ thu·∫≠t th·ªü 4-7-8:**
‚Ä¢ H√≠t v√†o 4 gi√¢y
‚Ä¢ Gi·ªØ h∆°i 7 gi√¢y  
‚Ä¢ Th·ªü ra 8 gi√¢y
‚Ä¢ L·∫∑p l·∫°i 3-4 l·∫ßn

**Th∆∞ gi√£n c∆° b·∫Øp:**
‚Ä¢ CƒÉng c∆° t·ª´ng nh√≥m 5 gi√¢y
‚Ä¢ Th·∫£ l·ªèng ho√†n to√†n 10 gi√¢y
‚Ä¢ B·∫Øt ƒë·∫ßu t·ª´ ch√¢n l√™n ƒë·∫ßu

**Ho·∫°t ƒë·ªông gi·∫£m stress:**
‚Ä¢ ƒêi b·ªô ngo√†i tr·ªùi 20-30 ph√∫t
‚Ä¢ Nghe nh·∫°c nh·∫π nh√†ng
‚Ä¢ Vi·∫øt nh·∫≠t k√Ω c·∫£m x√∫c
‚Ä¢ T·∫≠p yoga ho·∫∑c thi·ªÅn

**Khi n√†o c·∫ßn h·ªó tr·ª£:**
‚Ä¢ Stress k√©o d√†i h∆°n 2 tu·∫ßn
‚Ä¢ ·∫¢nh h∆∞·ªüng c√¥ng vi·ªác, h·ªçc t·∫≠p
‚Ä¢ C√≥ suy nghƒ© ti√™u c·ª±c
‚Ä¢ Thay ƒë·ªïi gi·∫•c ng·ªß, ƒÉn u·ªëng

B·∫°n ƒëang g·∫∑p stress ·ªü lƒ©nh v·ª±c n√†o? T√¥i c√≥ th·ªÉ g·ª£i √Ω c·ª• th·ªÉ h∆°n.`;
                    } else if (lowerMessage.includes('lo √¢u')) {
                        response = `üòå **Qu·∫£n l√Ω Lo √¢u:**

**K·ªπ thu·∫≠t Grounding 5-4-3-2-1:**
‚Ä¢ 5 ƒëi·ªÅu b·∫°n nh√¨n th·∫•y
‚Ä¢ 4 ƒëi·ªÅu b·∫°n ch·∫°m ƒë∆∞·ª£c
‚Ä¢ 3 ƒëi·ªÅu b·∫°n nghe th·∫•y
‚Ä¢ 2 ƒëi·ªÅu b·∫°n ng·ª≠i th·∫•y
‚Ä¢ 1 ƒëi·ªÅu b·∫°n n·∫øm ƒë∆∞·ª£c

**Th·ªü b·ª•ng:**
‚Ä¢ ƒê·∫∑t tay l√™n b·ª•ng
‚Ä¢ H√≠t v√†o ch·∫≠m, b·ª•ng ph√¨nh ra
‚Ä¢ Th·ªü ra ch·∫≠m, b·ª•ng x·∫πp xu·ªëng
‚Ä¢ T·∫≠p 5-10 ph√∫t m·ªói ng√†y

**Thay ƒë·ªïi suy nghƒ©:**
‚Ä¢ Nh·∫≠n di·ªán suy nghƒ© lo √¢u
‚Ä¢ H·ªèi: "ƒêi·ªÅu n√†y c√≥ th·∫≠t s·ª± x·∫£y ra kh√¥ng?"
‚Ä¢ T√¨m b·∫±ng ch·ª©ng ng∆∞·ª£c l·∫°i
‚Ä¢ T·∫≠p trung v√†o hi·ªán t·∫°i

**D·∫•u hi·ªáu c·∫ßn h·ªó tr·ª£:**
‚Ä¢ Lo √¢u k√©o d√†i h∆°n 6 th√°ng
‚Ä¢ ·∫¢nh h∆∞·ªüng sinh ho·∫°t h√†ng ng√†y
‚Ä¢ C√≥ c∆°n ho·∫£ng lo·∫°n
‚Ä¢ Tr√°nh n√© c√°c t√¨nh hu·ªëng

B·∫°n c√≥ mu·ªën t√¥i h∆∞·ªõng d·∫´n k·ªπ thu·∫≠t c·ª• th·ªÉ n√†o kh√¥ng?`;
                    } else if (lowerMessage.includes('tr·∫ßm c·∫£m')) {
                        response = `üíô **H·ªó tr·ª£ Tr·∫ßm c·∫£m:**

**Ho·∫°t ƒë·ªông t√≠ch c·ª±c:**
‚Ä¢ Ra ngo√†i √°nh s√°ng t·ª± nhi√™n 30 ph√∫t/ng√†y
‚Ä¢ V·∫≠n ƒë·ªông nh·∫π: ƒëi b·ªô, yoga, b∆°i l·ªôi
‚Ä¢ Duy tr√¨ gi·ªù gi·∫•c sinh ho·∫°t ƒë·ªÅu ƒë·∫∑n
‚Ä¢ K·∫øt n·ªëi v·ªõi ng∆∞·ªùi th√¢n, b·∫°n b√®

**ChƒÉm s√≥c b·∫£n th√¢n:**
‚Ä¢ ƒÇn u·ªëng ƒë·ªß ch·∫•t, ƒë√∫ng gi·ªù
‚Ä¢ Ng·ªß ƒë·ªß 7-8 ti·∫øng/ƒë√™m
‚Ä¢ Tr√°nh r∆∞·ª£u bia, ch·∫•t k√≠ch th√≠ch
‚Ä¢ L√†m vi·ªác m√¨nh th√≠ch m·ªói ng√†y

**T√¨m ki·∫øm h·ªó tr·ª£:**
‚Ä¢ Chia s·∫ª v·ªõi ng∆∞·ªùi tin c·∫≠y
‚Ä¢ Tham gia nh√≥m h·ªó tr·ª£
‚Ä¢ T√¨m chuy√™n gia t√¢m l√Ω
‚Ä¢ G·ªçi hotline t∆∞ v·∫•n: 1900 599 958

**‚ö†Ô∏è C·∫¢NH B√ÅO - C·∫ßn h·ªó tr·ª£ ngay:**
‚Ä¢ Suy nghƒ© t·ª± l√†m h·∫°i b·∫£n th√¢n
‚Ä¢ K·∫ø ho·∫°ch t·ª± t·ª≠
‚Ä¢ T·ª´ b·ªè ho√†n to√†n hy v·ªçng
‚Ä¢ S·ª≠ d·ª•ng ch·∫•t g√¢y nghi·ªán

B·∫°n c√≥ ƒëang c·∫£m th·∫•y an to√†n kh√¥ng? N·∫øu c√≥ suy nghƒ© ti√™u c·ª±c, h√£y t√¨m ki·∫øm h·ªó tr·ª£ ngay!`;
                    } else if (lowerMessage.includes('t·ª± tin')) {
                        response = `üí™ **X√¢y d·ª±ng T·ª± tin:**

**Th·ª±c h√†nh h√†ng ng√†y:**
‚Ä¢ Vi·∫øt 3 ƒëi·ªÅu t·ªët v·ªÅ b·∫£n th√¢n m·ªói s√°ng
‚Ä¢ Ho√†n th√†nh 1 vi·ªác nh·ªè m·ªói ng√†y
‚Ä¢ T·ª± khen ng·ª£i khi l√†m t·ªët
‚Ä¢ Tr√°nh so s√°nh v·ªõi ng∆∞·ªùi kh√°c

**Thay ƒë·ªïi suy nghƒ©:**
‚Ä¢ Thay "T√¥i kh√¥ng th·ªÉ" ‚Üí "T√¥i s·∫Ω th·ª≠"
‚Ä¢ Thay "T√¥i th·∫•t b·∫°i" ‚Üí "T√¥i h·ªçc ƒë∆∞·ª£c"
‚Ä¢ T·∫≠p trung v√†o ƒëi·ªÉm m·∫°nh
‚Ä¢ Ch·∫•p nh·∫≠n ƒëi·ªÉm y·∫øu l√† b√¨nh th∆∞·ªùng

**K·ªπ nƒÉng x√£ h·ªôi:**
‚Ä¢ Luy·ªán giao ti·∫øp v·ªõi ng∆∞·ªùi th√¢n
‚Ä¢ Tham gia ho·∫°t ƒë·ªông nh√≥m
‚Ä¢ H·ªçc c√°ch t·ª´ ch·ªëi l·ªãch s·ª±
‚Ä¢ B√†y t·ªè √Ω ki·∫øn m·ªôt c√°ch t√¥n tr·ªçng

**ChƒÉm s√≥c b·∫£n th√¢n:**
‚Ä¢ M·∫∑c qu·∫ßn √°o khi·∫øn b·∫°n c·∫£m th·∫•y t·ªët
‚Ä¢ T·∫≠p th·ªÉ d·ª•c ƒë·ªÅu ƒë·∫∑n
‚Ä¢ Ng·ªß ƒë·ªß gi·∫•c
‚Ä¢ ƒÇn u·ªëng l√†nh m·∫°nh

B·∫°n mu·ªën t·∫≠p trung v√†o kh√≠a c·∫°nh n√†o c·ªßa t·ª± tin?`;
                    } else if (lowerMessage.includes('chuy√™n nghi·ªáp')) {
                        response = `üè• **T√¨m ki·∫øm H·ªó tr·ª£ Chuy√™n nghi·ªáp:**

**Khi n√†o c·∫ßn chuy√™n gia:**
‚Ä¢ Tri·ªáu ch·ª©ng k√©o d√†i h∆°n 2 tu·∫ßn
‚Ä¢ ·∫¢nh h∆∞·ªüng c√¥ng vi·ªác, h·ªçc t·∫≠p
‚Ä¢ C√≥ suy nghƒ© t·ª± l√†m h·∫°i
‚Ä¢ Kh√¥ng th·ªÉ t·ª± qu·∫£n l√Ω

**Lo·∫°i chuy√™n gia:**
‚Ä¢ **B√°c sƒ© t√¢m th·∫ßn:** K√™ ƒë∆°n thu·ªëc, ch·∫©n ƒëo√°n
‚Ä¢ **Nh√† t√¢m l√Ω:** Tr·ªã li·ªáu t√¢m l√Ω, t∆∞ v·∫•n
‚Ä¢ **Chuy√™n vi√™n t∆∞ v·∫•n:** H·ªó tr·ª£ ng·∫Øn h·∫°n
‚Ä¢ **Nh√≥m h·ªó tr·ª£:** Chia s·∫ª kinh nghi·ªám

**C√°ch t√¨m chuy√™n gia:**
‚Ä¢ B·ªánh vi·ªán t√¢m th·∫ßn ƒë·ªãa ph∆∞∆°ng
‚Ä¢ Trung t√¢m t∆∞ v·∫•n t√¢m l√Ω
‚Ä¢ H·ªèi b√°c sƒ© gia ƒë√¨nh
‚Ä¢ T√¨m ki·∫øm online

**Hotline h·ªó tr·ª£:**
‚Ä¢ T∆∞ v·∫•n t√¢m l√Ω: 1900 599 958
‚Ä¢ B·ªánh vi·ªán T√¢m th·∫ßn TW: 024 3736 2121
‚Ä¢ Trung t√¢m Ph√≤ng ch·ªëng t·ª± t·ª≠: 1900 599 958

**Chu·∫©n b·ªã khi g·∫∑p chuy√™n gia:**
‚Ä¢ Ghi l·∫°i tri·ªáu ch·ª©ng
‚Ä¢ Mang theo k·∫øt qu·∫£ test
‚Ä¢ Chu·∫©n b·ªã c√¢u h·ªèi
‚Ä¢ Th√†nh th·∫≠t v·ªÅ c·∫£m x√∫c

B·∫°n c√≥ c·∫ßn t√¥i h∆∞·ªõng d·∫´n c√°ch t√¨m chuy√™n gia ph√π h·ª£p kh√¥ng?`;
                    }
                    
                    responses.push(`**Test ${index + 1}: "${message}"**\n${response}`);
                });
                
                resultDiv.className = 'result success';
                resultDiv.innerHTML = `‚úÖ Offline Service ho·∫°t ƒë·ªông t·ªët!<br><br><strong>Test Results:</strong><br>${responses.join('<br><br>---<br><br>')}`;
                
            } catch (error) {
                resultDiv.className = 'result error';
                resultDiv.innerHTML = `‚ùå L·ªói: ${error.message}`;
            }
        }
        
        async function testChatbotWithResults() {
            const resultDiv = document.getElementById('chatbot-result');
            resultDiv.style.display = 'block';
            resultDiv.innerHTML = 'üîÑ ƒêang test Chatbot v·ªõi test results...';
            
            try {
                // Simulate chatbot response v·ªõi test results
                const userMessage = "Gi·∫£i th√≠ch k·∫øt qu·∫£ test";
                
                if (mockTestResults.length > 0) {
                    const testNames = mockTestResults.map(result => {
                        switch(result.testType) {
                            case 'DASS_21': return 'DASS-21 (Lo √¢u, Tr·∫ßm c·∫£m, Stress)';
                            case 'PHQ_9': return 'PHQ-9 (Tr·∫ßm c·∫£m)';
                            default: return result.testType;
                        }
                    }).join(', ');
                    
                    const response = `üìä **K·∫øt qu·∫£ test c·ªßa b·∫°n:**

B·∫°n ƒë√£ ho√†n th√†nh ${mockTestResults.length} b√†i test: ${testNames}

**T·ªïng quan:**
${mockTestResults.map((result, index) => 
  `${index + 1}. **${testNames.split(', ')[index]}**: ${result.totalScore}/${result.maxScore} ƒëi·ªÉm - ${result.evaluation.level}`
).join('\n')}

**L∆∞u √Ω quan tr·ªçng:**
‚Ä¢ K·∫øt qu·∫£ ch·ªâ mang t√≠nh tham kh·∫£o
‚Ä¢ Kh√¥ng thay th·∫ø ch·∫©n ƒëo√°n chuy√™n m√¥n
‚Ä¢ N√™n th·∫£o lu·∫≠n v·ªõi chuy√™n gia t√¢m l√Ω

**G·ª£i √Ω ti·∫øp theo:**
‚Ä¢ Th·ª±c h√†nh k·ªπ thu·∫≠t th∆∞ gi√£n
‚Ä¢ Theo d√µi t√¨nh tr·∫°ng theo th·ªùi gian
‚Ä¢ T√¨m ki·∫øm h·ªó tr·ª£ chuy√™n nghi·ªáp n·∫øu c·∫ßn

B·∫°n mu·ªën t√¥i gi·∫£i th√≠ch chi ti·∫øt v·ªÅ test n√†o?`;
                    
                    resultDiv.className = 'result success';
                    resultDiv.innerHTML = `‚úÖ Chatbot v·ªõi test results ho·∫°t ƒë·ªông!<br><br><strong>Ph·∫£n h·ªìi:</strong><br>${response}`;
                } else {
                    resultDiv.className = 'result error';
                    resultDiv.innerHTML = '‚ùå Kh√¥ng c√≥ test results ƒë·ªÉ test';
                }
                
            } catch (error) {
                resultDiv.className = 'result error';
                resultDiv.innerHTML = `‚ùå L·ªói: ${error.message}`;
            }
        }
        
        function testFallbackResponse() {
            const resultDiv = document.getElementById('fallback-result');
            resultDiv.style.display = 'block';
            resultDiv.innerHTML = 'üîÑ ƒêang test fallback response...';
            
            try {
                const fallbackText = `Xin ch√†o! T√¥i l√† CHUN - AI Companion h·ªó tr·ª£ s·ª©c kh·ªèe t√¢m l√Ω.

T√¥i c√≥ th·ªÉ gi√∫p b·∫°n:
‚Ä¢ Hi·ªÉu k·∫øt qu·∫£ test t√¢m l√Ω
‚Ä¢ G·ª£i √Ω k·ªπ thu·∫≠t qu·∫£n l√Ω stress
‚Ä¢ H∆∞·ªõng d·∫´n t√¨m ki·∫øm h·ªó tr·ª£ chuy√™n nghi·ªáp
‚Ä¢ Cung c·∫•p t√†i nguy√™n t·ª± gi√∫p ƒë·ª°

B·∫°n mu·ªën trao ƒë·ªïi v·ªÅ ƒëi·ªÅu g√¨?`;
                
                resultDiv.className = 'result success';
                resultDiv.innerHTML = `‚úÖ Fallback response ho·∫°t ƒë·ªông!<br><br><strong>Ph·∫£n h·ªìi:</strong><br>${fallbackText}`;
                
            } catch (error) {
                resultDiv.className = 'result error';
                resultDiv.innerHTML = `‚ùå L·ªói: ${error.message}`;
            }
        }
    </script>
</body>
</html>
