<!DOCTYPE html>
<html>

<head>
    <title>Test SoulFriend Chatbot</title>
    <style>
        body {
            font-family: Arial;
            padding: 20px;
        }

        .result {
            margin: 10px 0;
            padding: 10px;
            border: 1px solid #ddd;
        }

        .success {
            background: #d4edda;
        }

        .error {
            background: #f8d7da;
        }

        button {
            padding: 10px 20px;
            margin: 5px;
        }
    </style>
</head>

<body>
    <h1>üß™ Test SoulFriend Backend</h1>

    <div>
        <label>Backend URL:</label>
        <input type="text" id="backendUrl" value="https://soulfriend-production.up.railway.app" style="width: 400px;">
    </div>

    <div style="margin: 20px 0;">
        <button onclick="testHealth()">1. Test Health</button>
        <button onclick="testChatbot()">2. Test Chatbot</button>
        <button onclick="testGemini()">3. Test Gemini Status</button>
    </div>

    <div id="results"></div>

    <script>
        function getBackendUrl() {
            return document.getElementById('backendUrl').value;
        }

        function showResult(title, data, isSuccess) {
            const div = document.createElement('div');
            div.className = 'result ' + (isSuccess ? 'success' : 'error');
            div.innerHTML = `<strong>${title}</strong><pre>${JSON.stringify(data, null, 2)}</pre>`;
            document.getElementById('results').insertBefore(div, document.getElementById('results').firstChild);
        }

        async function testHealth() {
            try {
                const url = getBackendUrl() + '/api/health';
                console.log('Testing:', url);
                const response = await fetch(url);
                const data = await response.json();
                showResult('‚úÖ Health Check', data, response.ok);

                if (data.gemini === 'initialized') {
                    alert('‚úÖ Gemini AI is working!');
                } else {
                    alert('‚ö†Ô∏è Gemini AI not initialized - Check GEMINI_API_KEY in Railway');
                }
            } catch (error) {
                showResult('‚ùå Health Check Failed', { error: error.message }, false);
                alert('‚ùå Backend kh√¥ng k·∫øt n·ªëi ƒë∆∞·ª£c!\nCheck Railway URL ho·∫∑c CORS settings');
            }
        }

        async function testChatbot() {
            try {
                const url = getBackendUrl() + '/api/v2/chatbot/message';
                const response = await fetch(url, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        message: 'Xin ch√†o',
                        userId: 'test_user',
                        sessionId: 'test_session'
                    })
                });
                const data = await response.json();
                showResult('üí¨ Chatbot Test', data, response.ok);

                if (data.success) {
                    alert('‚úÖ Chatbot ƒëang ho·∫°t ƒë·ªông!\n\nResponse: ' + data.data.message);
                }
            } catch (error) {
                showResult('‚ùå Chatbot Test Failed', { error: error.message }, false);
            }
        }

        async function testGemini() {
            try {
                const url = getBackendUrl() + '/api/health/detailed';
                const response = await fetch(url);
                const data = await response.json();
                showResult('üîç Detailed Health', data, response.ok);
            } catch (error) {
                showResult('‚ùå Detailed Health Failed', { error: error.message }, false);
            }
        }
    </script>
</body>

</html>